variables:
  FMK_NEXUS: fmk.nexus-ci.onefiserv.net/apm/0007440
  NEXUS_REPO_USER_DEV: "svc-apim-cicd-dev"
  NEXUS_REPO_PASS_DEV: "F_arX1Z%fIQSfZEM@aJL9RRk*"
  GITLAB_PER_TOKEN: "F42ozyyemp_pf3szWGsB"

default:
  tags:
    - apimhub-shell

stages:
  - vendor-deploy
  - custom-deploy

deploy-vendor-images:
  stage: vendor-deploy
  script:
    - echo "Deploying vendor image to Nexus..."
    - chmod +x vendor-deploy.sh
    - ./vendor-deploy.sh "$NEXUS_REPO_USER_DEV" "$NEXUS_REPO_PASS_DEV"
  rules:
    - changes:
        - vendor-image-values.json  # Only runs if this file changes

deploy-custom-images:
  stage: custom-deploy
  script:
    - echo "Deploying custom image to Nexus..."
    - chmod +x custom-deploy.sh
    - ./custom-deploy.sh "$NEXUS_REPO_USER_DEV" "$NEXUS_REPO_PASS_DEV" "$GITLAB_USERNAME" "$GITLAB_PER_TOKEN"
  rules:
    - when: always  # This will run on every commit to any branch
