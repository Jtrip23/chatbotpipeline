# master-pipeline.yaml

variables:
  IMAGE_NAME: "$CI_PROJECT_NAME"
  IMAGE_TAG: "$CI_COMMIT_SHORT_SHA"
  DOCKER_IMAGE: "${FMK_NEXUS}/${IMAGE_NAME}:${IMAGE_TAG}"

stages:
  - build
  - push

build-image:
  stage: build
  script:
    - echo "Building Docker image..."
    - docker build -t "$DOCKER_IMAGE" .
  only:
    - branches

push-image:
  stage: push
  script:
    - echo "Logging in to Nexus Docker Registry..."
    - echo "$NEXUS_REPO_PASSWORD" | docker login -u "$NEXUS_REPO_USER" --password-stdin "$FMK_NEXUS"
    - echo "Pushing image to Nexus..."
    - docker push "$DOCKER_IMAGE"
  only:
    - branches